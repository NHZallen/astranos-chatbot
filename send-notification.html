<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Astra PWA é€šçŸ¥æµ‹è¯•å·¥å…·</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; margin: 2em; background-color: #f4f4f9; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { color: #3b82f6; }
        label { display: block; margin-top: 1em; font-weight: bold; }
        input, textarea { width: 100%; padding: 0.5em; margin-top: 0.5em; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #3b82f6; color: white; padding: 0.8em 1.5em; border: none; border-radius: 4px; font-size: 1em; cursor: pointer; margin-top: 1.5em; }
        button:disabled { background-color: #a0a0a0; }
        #status { margin-top: 1.5em; padding: 1em; background-color: #e0e0e0; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Astra PWA é€šçŸ¥æµ‹è¯•å·¥å…·</h1>
        <p>è¿™ä¸ªå·¥å…·å¯ä»¥ç›´æ¥å‘½ä»¤æ‚¨ PWA çš„ Service Worker æ˜¾ç¤ºä¸€åˆ™é€šçŸ¥ï¼Œç”¨æ¥æµ‹è¯•é€šçŸ¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿ä½œã€‚</p>
        
        <label for="title">é€šçŸ¥æ ‡é¢˜:</label>
        <input type="text" id="title" value="ğŸ”” æ–°ç‰ˆæœ¬å·²æ¨å‡ºï¼">

        <label for="body">é€šçŸ¥å†…å®¹ (ä¼šè‡ªåŠ¨æˆªæ–­):</label>
        <textarea id="body" rows="4">è¿™æ˜¯ 15.10.1 ç‰ˆæœ¬çš„æ›´æ–°å†…å®¹ï¼šç°åœ¨æ”¯æ´æ¨æ’­é€šçŸ¥ï¼Œè®©æ‚¨ä¸å†é”™è¿‡ä»»ä½•é‡è¦æ›´æ–°ï¼</textarea>

        <button id="send-btn">å‘é€æµ‹è¯•é€šçŸ¥</button>

        <div id="status">çŠ¶æ€ï¼šç­‰å¾…æ“ä½œ...</div>
    </div>

    <script>
        const sendBtn = document.getElementById('send-btn');
        const statusDiv = document.getElementById('status');
        const titleInput = document.getElementById('title');
        const bodyInput = document.getElementById('body');

        // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æ´ Service Worker
        if (!('serviceWorker' in navigator)) {
            sendBtn.disabled = true;
            statusDiv.textContent = 'é”™è¯¯ï¼šæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æ´ Service Workerã€‚';
        }

        sendBtn.addEventListener('click', async () => {
            statusDiv.textContent = 'çŠ¶æ€ï¼šæ­£åœ¨å‘é€æŒ‡ä»¤...';
            sendBtn.disabled = true;

            try {
                // 1. è·å– Service Worker çš„æ³¨å†Œç‰©ä»¶
                const registration = await navigator.serviceWorker.ready;
                if (!registration.active) {
                    throw new Error('æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„ Service Workerã€‚');
                }

                // 2. å‡†å¤‡è¦å‘é€çš„èµ„æ–™
                const payload = {
                    type: 'SHOW_NOTIFICATION_MANUALLY', // è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å®šä¹‰ï¼Œç”¨æ¥è¯†åˆ«çš„æŒ‡ä»¤
                    title: titleInput.value,
                    body: bodyInput.value
                };

                // 3. ä½¿ç”¨ postMessage å°†æŒ‡ä»¤å’Œèµ„æ–™å‘é€ç»™ Service Worker
                registration.active.postMessage(payload);

                statusDiv.textContent = 'çŠ¶æ€ï¼šæŒ‡ä»¤å·²æˆåŠŸå‘é€ç»™ Service Workerï¼\nè¯·æ£€æŸ¥æ‚¨çš„æ‰‹æœº/ç”µè„‘æ˜¯å¦è·³å‡ºé€šçŸ¥ã€‚';

            } catch (error) {
                statusDiv.textContent = `çŠ¶æ€ï¼šå‘ç”Ÿé”™è¯¯ï¼\n${error.message}\nè¯·ç¡®è®¤ PWA å·²ç»å®‰è£…å¹¶è‡³å°‘è¿è¡Œè¿‡ä¸€æ¬¡ã€‚`;
            } finally {
                sendBtn.disabled = false;
            }
        });
    </script>

</body>
</html>
