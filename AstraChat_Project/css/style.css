body {
    touch-action: manipulation;
}
    #history-sidebar.visible ~ #scroll-to-bottom-btn {
    opacity: 0;
    pointer-events: none;
}
    #show-prompts-btn.active {
    color: #fbbf24; /* 這是一個漂亮的黃色 */
}
    #selection-mode-btn.active,
#open-search-btn.active {
    color: var(--button-primary-bg);
}
    main.flex-1 {
    /* 強制隱藏所有超出寬度的內容 */
    overflow-x: hidden;
}
    #history-sidebar .history-sidebar-item {
    /* 這是為了讓指示條可以相對於它定位，非常重要！ */
    position: relative; 
}

#history-sidebar .history-sidebar-item.active {
    background-color: var(--hover-bg); 
    color: var(--text-primary) !important; 
    font-weight: 600; 
    /* 增加左邊距，為指示條留出空間 */
    padding-left: 1.25rem; 
}

#history-sidebar .history-sidebar-item.active::before {
    content: ''; 
    position: absolute; 
    left: 6px; 
    top: 50%; 
    transform: translateY(-50%); 
    width: 4px; 
    height: 60%; 
    background-color: var(--button-primary-bg);
    border-radius: 9999px; 
    animation: indicator-pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}
    #history-sidebar-overlay {
    transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

body.custom-wallpaper-active #history-sidebar {
    backdrop-filter: blur(20px); /* 套用背景模糊濾鏡 */
    -webkit-backdrop-filter: blur(20px); /* 兼容 Safari */
    
    /* 強制使用淺色的半透明背景，無論桌布是深是淺 */
    background-color: rgba(255, 255, 255, 0.55) !important; 
    
    border-left: 1px solid rgba(255, 255, 255, 0.6) !important; /* 設定半透明亮色邊框 */
    box-shadow: -4px 0px 15px rgba(0, 0, 0, 0.05); /* 加上陰影 */
    
    /* 確保側邊欄內的文字顏色是深色，以便在淺色背景上閱讀 */
    color: #000000 !important; 
}

/* 同時，也需要強制覆蓋標題的顏色，確保可讀性 */
body.custom-wallpaper-active #history-sidebar h3 {
    color: #000000 !important;
}
#history-sidebar-overlay.visible {
    display: block; /* 讓它可以被看見 */
    opacity: 1;   /* 讓它從透明變為半透明 */
}
    #history-sidebar {
    /* 預設將側邊欄向右移出畫面外 */
    transform: translateX(100%); 
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    -webkit-user-select: none; /* 防止在滑動時選取文字 */
    user-select: none;
}

#history-sidebar.visible {
    /* 當有 .visible class 時，將側邊欄移回畫面內 */
    transform: translateX(0); 
}

/* 側邊欄內的每個訊息項目樣式 */
.history-sidebar-item {
    padding: 0.75rem;
    border-radius: 0.5rem;
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; /* 當文字太長時，顯示 ... */
    font-size: 0.875rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.history-sidebar-item:hover {
    background-color: var(--hover-bg);
    color: var(--text-primary);
}

/* 當訊息被跳轉到時的短暫高亮效果 */
.message-highlight {
    /* 使用 animation 來實現閃爍效果 */
    animation: highlight-fade 1.5s ease-out;
}

@keyframes highlight-fade {
    0% { background-color: rgba(250, 204, 21, 0.7); } /* 黃色的高亮 */
    100% { background-color: transparent; }
}
    .sidebar-item {
    position: relative; /* 這是為了讓指示條可以相對於它定位，非常重要！ */
    border-radius: 0.5rem;
    transition: all 0.2s ease-in-out; /* 保留平滑動畫 */
    padding-left: 1.25rem; /* 稍微增加左邊距，為指示條留出空間 */
}
.dark .sidebar-item.active,
.sidebar .sidebar-item.active {
    background-color: var(--hover-bg); 
    color: var(--text-primary) !important; 
    font-weight: 600; 
}
.sidebar-item.active::before {
    content: ''; /* 偽元素必須要有 content 屬性 */
    position: absolute; /* 絕對定位，相對於 .sidebar-item */
    left: 6px; /* 離左邊邊緣的距離 */
    top: 50%; /* 定位在垂直置中的位置 */
    transform: translateY(-50%); /* 透過 transform 精準置中 */
    width: 4px; /* 指示條的寬度 */
    height: 60%; /* 指示條的高度，佔父元素的 60% */
    background-color: var(--button-primary-bg);
    
    border-radius: 9999px; /* 讓指示條兩端變圓滑 */
    animation: indicator-pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}
@keyframes indicator-pop-in {
    from {
        opacity: 0;
        transform: translateY(-50%) scale(0.5);
    }
    to {
        opacity: 1;
        transform: translateY(-50%) scale(1);
    }
}

    .sidebar-section {
    background-color: transparent; 
    border-radius: 0;          
    margin-bottom: 0.25rem;    /* <--- 變小了 */
    padding-bottom: 0.25rem;   /* <--- 變小了 */
    border: 0;                 
}
/* ✨ 新增：移除最後一個區塊的底線和間距，讓佈局更乾淨 */
.scroll-area > .sidebar-section:last-child {
    border-bottom: none;
    padding-bottom: 0;
    margin-bottom: 0;
}

.sidebar-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.2rem 0.5rem 0.2rem 0.75rem; /* <--- 上下的值變小了 */
    cursor: pointer;
    user-select: none;
}

.sidebar-section-header .title-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.sidebar-section-header .actions-group {
    display: flex;
    align-items: center;
}

.section-action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 9999px;
    color: var(--text-secondary);
}
.section-action-btn:hover {
    background-color: var(--active-bg);
    color: var(--text-primary);
}

/* 膠囊狀的新增按鈕 */
.section-add-btn {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.65rem 0.25rem 0.25rem;
    font-size: 0.8rem;
    font-weight: 500;
    border-radius: 9999px;
    background-color: var(--hover-bg);
    color: var(--text-secondary);
}
.section-add-btn:hover {
    background-color: var(--active-bg);
    color: var(--text-primary);
}
.section-add-btn svg {
    width: 1.25rem;
    height: 1.25rem;
}

.sidebar-section-content {
    display: grid; /* 1. 設定為 grid 佈局 */
    grid-template-rows: 0fr; /* 2. 初始狀態下，網格的列高為 0，達到收合效果 */
    transition: grid-template-rows 0.35s cubic-bezier(0.4, 0, 0.2, 1); /* 3. 讓列高變化產生動畫 */
    padding: 0 0.25rem;
}

/* 為了讓 grid 動畫正常運作，需要設定內容的 overflow */
.sidebar-section-content > div {
    overflow: hidden;
}

/* 展開時的樣式 */
.sidebar-section[data-open="true"] .sidebar-section-content {
    grid-template-rows: 1fr; /* 4. 展開時，讓列高變為內容的實際高度 */
    padding-bottom: 0.5rem;
}

.section-toggle-arrow {
    transition: transform 0.3s ease;
    transform: rotate(-90deg); /* 修改點 1: 預設就先轉成向右 */
}
.sidebar-section[data-open="true"] .section-toggle-arrow {
    transform: rotate(0deg); /* 修改點 2: 展開時轉回來 */
}
    #user-controls {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

#user-profile-btn {
    flex: 1; /* 讓使用者名稱區域佔滿可用空間 */
    padding: 0.5rem; /* 調整內邊距 */
    gap: 0.75rem;
}
#user-profile-btn:hover {
}

.user-avatar {
    width: 2rem;
    height: 2rem;
    border-radius: 9999px;
    background-color: var(--button-primary-bg);
    color: var(--button-primary-text);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    flex-shrink: 0; /* 防止頭像被壓縮 */
}

/* 獨立的設定圖示按鈕 */
#settings-btn {
    width: 2.75rem; /* 讓它和使用者卡片差不多高 */
    height: 2.75rem;
    padding: 0.75rem;
    justify-content: center;
}
#settings-btn:hover {
}
#settings-btn span {
    display: none; /* 隱藏原本的 "設定" 文字 */
}
#settings-btn span {
    display: none; /* 隱藏原本的 "設定" 文字 */
}
    #file-options-popover button {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
    #attachment-menu-overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 99;
    opacity: 0;
    transition: opacity 0.3s ease;
}

#attachment-menu {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: var(--modal-bg);
    border-top-left-radius: 1.5rem;
    border-top-right-radius: 1.5rem;
    z-index: 100;
    padding: 1rem;
    transform: translateY(100%);
    transition: transform 0.3s ease-out;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    touch-action: none;
}

#attachment-menu.visible {
    transform: translateY(0);
}

#attachment-menu-overlay.visible {
    opacity: 1;
}

#attachment-menu .menu-header {
    padding: 0.5rem 1rem;
    text-align: center;
    font-weight: 600;
    color: var(--text-primary);
    background-color: var(--sidebar-bg);
    border-radius: 0.75rem;
    margin-bottom: 1rem;
    user-select: none;
}

#attachment-menu .menu-options {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

#attachment-menu .menu-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    gap: 1rem;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    font-size: 1rem;
    color: var(--text-primary);
}

#attachment-menu .menu-item:last-child {
    border-bottom: none;
}

#attachment-menu .menu-item:hover {
    background-color: var(--hover-bg);
}

#attachment-menu .menu-item svg {
    width: 24px;
    height: 24px;
    color: var(--text-secondary);
}

/* 針對暗黑模式和自訂桌布的適配 */
.dark #attachment-menu .menu-header,
.dark #attachment-menu .menu-item {
    color: var(--text-primary);
}
.dark #attachment-menu .menu-item svg {
    color: var(--text-secondary);
}
body.custom-wallpaper-active #attachment-menu {
    color: #111827 !important;
    background-color: rgba(255, 255, 255, 0.85) !important;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-color: rgba(200, 200, 200, 0.5) !important;
}
body.custom-wallpaper-active #attachment-menu .menu-header,
body.custom-wallpaper-active #attachment-menu .menu-item {
     color: #111827 !important;
}
body.custom-wallpaper-active #attachment-menu .menu-item svg {
    color: #6b7280 !important;
}
    @keyframes indicator-enter {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

  
@keyframes indicator-exit {
    from {
        opacity: 1;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        transform: translateY(-10px);
    }
}
.input-indicator-item {
}


.input-indicator-item.enter {
    animation: indicator-enter 0.3s ease-out forwards;
}


.input-indicator-item.exit {
    animation: indicator-exit 0.3s ease-out forwards;
}
#store-category-list {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
    -webkit-overflow-scrolling: touch; /* 為了在行動裝置上有更好的滾動體驗 */
}
#store-category-list::-webkit-scrollbar {
    display: none;
}
.store-category-btn {
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-secondary);
    background-color: transparent;
    cursor: pointer;
    white-space: nowrap; /* 確保按鈕文字不換行 */
    transition: all 0.2s ease-in-out;
}
.store-category-btn:hover {
    color: var(--text-primary);
    background-color: var(--hover-bg);
    border-color: var(--text-primary);
}
.store-category-btn.active {
    color: var(--button-primary-text);
    background-color: var(--button-primary-bg);
    border-color: transparent;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
}
    :root {
        --chat-bg: #ffffff;
        --sidebar-bg: #f7f7f8;
        --input-bar-bg: #ffffff;
        --input-field-bg: #f9fafb;
        --text-primary: #111827;
        --text-secondary: #6b7280;
        --border-color: #e5e7eb;
        --hover-bg: #f3f4f6;
        --active-bg: #e5e7eb;
        --modal-bg: #ffffff;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --ai-bubble-bg: var(--sidebar-bg);
        --user-bubble-bg: #3b82f6;
        --button-primary-bg: #3b82f6;
        --button-primary-hover-bg: #2563eb;
        --button-primary-text: #ffffff;
    }
    .dark {
        --chat-bg: #111111;
        --sidebar-bg: #1c1c1c;
        --input-bar-bg: #1c1c1c;
        --input-field-bg: #2d2d2d;
        --text-primary: #f9fafb;
        --text-secondary: #9ca3af;
        --border-color: #374151;
        --hover-bg: #374151;
        --active-bg: #4b5563;
        --modal-bg: #1f2937;
        --shadow-color: rgba(0, 0, 0, 0.4);
        --ai-bubble-bg: var(--sidebar-bg);
        --user-bubble-bg: #2563eb;
    }
    @keyframes subtleFadeInUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    @keyframes subtleScaleIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
    button, .sidebar-item, .settings-nav-item, .theme-btn, .voice-input-btn, .model-option-btn-container, .color-option {
        transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, border-color 0.2s ease-in-out;
    }
button:not(.btn-primary):hover:not(:disabled) {
    transform: translateY(-1px);
    filter: brightness(95%);
}
button:not(.btn-primary):active:not(:disabled) {
    transform: translateY(0px);
    box-shadow: none;
    filter: brightness(90%);
}
    body { background-color: var(--chat-bg); color: var(--text-primary); }
    .scroll-area {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: contain;
    }
    body.modal-open {
        overflow: hidden;
    }
    .sidebar {
        background-color: var(--sidebar-bg);
        border-right: 1px solid var(--border-color);
        transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    }
    .scroll-area::-webkit-scrollbar { width: 8px; }
    .scroll-area::-webkit-scrollbar-track { background: transparent; }
    .scroll-area::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
    .scroll-area::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    .modal {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
    }
    .modal.visible { opacity: 1; visibility: visible; }
    .modal > div {
        transform: scale(0.95);
        transition: transform 0.2s ease-in-out;
    }
    .modal.visible > div { transform: scale(1); }
    #auth-container {
        transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    }
    #auth-container.fade-out {
        opacity: 0;
        transform: scale(0.95);
        pointer-events: none;
    }
    #app-container, #store-container {
        opacity: 0;
        transform: scale(1.05);
        transition: opacity 0.4s ease-in 0.2s, transform 0.4s ease-in 0.2s;
    }
    #app-container.visible, #store-container.visible {
        opacity: 1;
        transform: scale(1);
    }
    @keyframes chatFadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .chat-view-transition {
        animation: chatFadeIn 0.3s ease-out forwards;
    }
    .folder-item > .folder-content-container {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 為了讓 grid 動畫正常運作，需要設定內容的 overflow */
.folder-item > .folder-content-container > div {
    overflow: hidden;
}

.folder-item[data-open="true"] > .folder-content-container {
    grid-template-rows: 1fr;
}
    @keyframes pulse-glow {
        from {
            box-shadow: 0 0 0 0px rgba(59, 130, 246, 0.4);
            border-color: rgba(59, 130, 246, 0.8);
        }
        to   {
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0);
            border-color: var(--border-color);
        }
    }
    .input-wrapper {
    transition: box-shadow 0.2s ease-in-out, border-color 0.2s ease-in-out, padding-top 0.3s ease-in-out; /* 新增 padding-top 的過渡效果 */
    position: relative;
    flex-direction: column;
    padding-top: 0; /* ✨ 新增：預設沒有上方內邊距 */
}
    #message-input {
    line-height: 1.5rem; /* 設定行高，這對於計算高度很重要 */
    max-height: calc(1.5rem * 8 + 1rem); /* 8行的高度 (8 * 行高) + 上下 padding (p-2 = 0.5rem * 2) */
    transition: height 0.2s ease-out; /* 讓高度變化有平滑的動畫效果 */
    overflow-y: auto; /* 當內容超出最大高度時，顯示滾動條 */
    -webkit-overflow-scrolling: touch; /* ---> 新增：在 iOS 等裝置上啟用慣性滾動 <--- */
    scrollbar-width: thin; /* ---> 新增：讓滾動條變細一些 (適用於 Firefox) <--- */
    scrollbar-color: var(--border-color) transparent; /* ---> 新增：設定滾動條顏色 <--- */
}
#message-input::-webkit-scrollbar {
    width: 6px;
}
#message-input::-webkit-scrollbar-thumb {
    background-color: var(--border-color);
    border-radius: 3px;
}
#message-input::-webkit-scrollbar-track {
    background: transparent;
}


#message-input.expanded {
    max-height: 50vh; /* 展開後的最大高度，設定為視窗高度的一半 */
}


#expand-input-btn.rotated {
    transform: rotate(180deg); /* 讓箭頭旋轉180度，表示可收合 */
}
    #input-bar-container .input-wrapper.has-indicators > .flex.items-end {
    margin-top: 0.9rem; /* 8px 的間距，您可以依喜好調整這個數值 */
}
    .input-wrapper.has-indicators {
    padding-top: 2.25rem; /* 36px，為指示器留出空間，可微調 */
}


#input-indicator-container {
    position: absolute;
    top: 0.5rem; /* 距離頂部 8px */
    left: 0.5rem; /* 距離左側 8px */
    right: 0.5rem; /* 距離右側 8px */
    
    display: flex;
    overflow-x: auto;
    white-space: nowrap;
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none;   /* Firefox */
    -webkit-overflow-scrolling: touch;
}


#input-indicator-container::-webkit-scrollbar {
    display: none; /* 隱藏滾動條 */
}


#input-indicator-container .input-indicator-item {
    flex-shrink: 0; /* 防止項目被壓縮 */
}
    .input-wrapper.pulse-glow {
        animation: pulse-glow 0.7s ease-out;
    }
    #auth-container .auth-form-container {
        animation: subtleFadeInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }
    .sidebar {
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        background-color: rgba(255, 255, 255, 0.55);
        border-right: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 4px 0px 15px rgba(0, 0, 0, 0.05);
        --border-color: rgba(0, 0, 0, 0.1);
    }
    .dark .sidebar {
        background-color: rgba(30, 30, 30, 0.5);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 4px 0px 20px rgba(0, 0, 0, 0.2);
        --border-color: rgba(255, 255, 255, 0.1);
    }
    .popover {
        box-shadow: 0 10px 15px -3px var(--shadow-color), 0 4px 6px -2px var(--shadow-color);
        background-color: var(--modal-bg);
        opacity: 0;
        visibility: hidden;
        transform: scale(0.95) translateY(-20px);
        transition: opacity 0.15s ease-out, transform 0.15s ease-out, visibility 0.15s;
        transform-origin: top;
    }
    .popover.visible {
        opacity: 1;
        visibility: visible;
        transform: scale(1) translateY(0);
    }
    #model-options-popover { transform-origin: top right; }
    #model-options-popover {
    /* 移除內邊距，交給子元素處理 */
    padding: 0;
    /* 隱藏從側面滑入的內容 */
    overflow: hidden;
    /* 動態高度變化時有過渡效果，這是讓高度變化平滑的關鍵 */
    transition: opacity 0.15s ease-out, transform 0.15s ease-out, visibility 0.15s, height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 建立一個 flex 容器來水平排列兩個視圖 */
#model-views-container {
    display: flex;
    /* 寬度為父容器的兩倍，因為有兩個視圖 */
    width: 200%;
    /* 核心動畫：當 transform 改變時，產生滑動效果 */
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 當切換到「其他模型」時，整個容器向左滑動 50% (即一個視圖的寬度) */
#model-views-container.show-other-models {
    transform: translateX(-50%);
}

/* 每個獨立的視圖 (Gemini / 其他模型) 的樣式 */
.model-view {
    /* 每個視圖佔據容器寬度的一半 */
    width: 50%;
    flex-shrink: 0;
    /* 將原本在父容器的內邊距移到這裡 */
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
    
    /* ▼▼▼ 新增的程式碼 ▼▼▼ */
    max-height: 100%; /* 確保視圖不會超過父容器的高度 */
    overflow-y: auto;  /* 如果內容超出，讓這個視圖自己滾動 */
    /* ▲▲▲ 新增的程式碼 ▲▲▲ */
}
    .model-view::-webkit-scrollbar {
    width: 6px; /* 滾動條寬度 */
}

.model-view::-webkit-scrollbar-track {
    background: transparent; /* 滾動條軌道背景透明 */
}

.model-view::-webkit-scrollbar-thumb {
    background-color: var(--border-color); /* 滾動條滑塊顏色 */
    border-radius: 3px; /* 滑塊圓角 */
}

.model-view::-webkit-scrollbar-thumb:hover {
    background-color: var(--text-secondary); /* 鼠標懸停時的滑塊顏色 */
}

/* 適用於 Firefox */
.model-view {
    scrollbar-width: thin; /* 讓滾動條變細 */
    scrollbar-color: var(--border-color) transparent; /* 滑塊顏色 軌道顏色 */
}
#file-options-popover {
    background-color: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 0.5rem;
    transform-origin: bottom left;
    transform: scale(0.95) translateY(10px);
}
.dark #file-options-popover {
    background-color: rgba(30, 30, 30, 0.25);
    border: 1px solid rgba(255, 255, 255, 0.15);
}
#file-options-popover.visible {
    transform: scale(1) translateY(0);
}
#file-options-popover button {
    color: #111827;
}
.dark #file-options-popover button {
    color: #f9fafb;
}
#file-options-popover button svg {
    color: inherit;
    opacity: 0.7;
}
#file-options-popover button:hover {
    background-color: rgba(255, 255, 255, 0.15);
}
.dark #file-options-popover button:hover {
    background-color: rgba(255, 255, 255, 0.1);
}
    .folder-summary .folder-arrow {
        transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    }
    .folder-item[data-open="true"] .folder-summary .folder-arrow {
        transform: rotate(90deg);
    }
    #batch-action-bar {
        transition: opacity 0.3s ease, transform 0.3s ease;
        transform: translateY(0);
        opacity: 1;
    }
    #batch-action-bar.hidden {
        opacity: 0;
        transform: translateY(20px);
        pointer-events: none;
    }
    #sidebar-overlay {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s cubic-bezier(0.4, 0.0, 0.2, 1), visibility 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    }
    #sidebar-overlay.visible {
        opacity: 1;
        visibility: visible;
    }
    #settings-modal .flex-1.p-6.overflow-y-auto {
    position: relative; /* 這是為了讓子元素可以相對於它定位，非常重要！ */
    padding: 0; /* 移除舊的內邊距，我們把它移到子元素上 */
    overflow-y: hidden; /* <-- ✨ 就是加上這一行！ */
}

/* --- ✨ 修改：設定所有區塊的基礎樣式 --- */
.settings-section {
    /* 讓所有區塊都疊在同一個位置 */
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;

    /* 預設都透明且不可點擊 */
    opacity: 0;
    pointer-events: none;
    
    /* 讓區塊內部可以滾動 */
    overflow-y: auto; 
    
    /* 將原本父容器的內邊距加到這裡，讓每個區塊都有自己的邊距 */
    padding: 1.5rem; /* 1.5rem 等於 Tailwind CSS 的 p-6 */
    
    /* 過渡動畫：從 display 改為 opacity，效果更平滑 */
    transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
    visibility: hidden;

    /* 保留您原本漂亮的入場動畫 */
    animation: subtleFadeInUp 0.4s ease-out;
}

/* --- ✨ 修改：設定作用中區塊的樣式 --- */
.settings-section.active {
    /* 不再使用 display: block，而是讓它變得可見且可互動 */
    opacity: 1;
    pointer-events: auto;
    visibility: visible;
}

/* --- ✨ 新增：針對手機版佈局的特殊處理 --- */
@media (max-width: 768px) {
    /* 在手機上，我們恢復原本的佈局方式，而不是疊在一起 */
    #settings-modal .flex-1.p-6.overflow-y-auto {
    position: static; 
    padding: 1.5rem; 
    overflow-y: auto; /* <--- 就是加上這一行！ */
}
    .settings-section {
        position: static; /* 恢復靜態定位 */
        height: auto;     /* 高度自動 */
        opacity: 1;
        pointer-events: auto;
        visibility: visible;
        overflow-y: visible; /* 不需要內部滾動 */
        padding: 0; /* 移除內邊距 */
        
        /* 恢復您原本為手機版設計的樣式 */
        display: block !important;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 1.5rem;
        margin-bottom: 1.5rem;
    }
    .settings-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    /* 在手機上，我們不需要 .active 來切換可見度，所以把它重置 */
    .settings-section.active {
       /* 不需要額外樣式 */
    }
}
    :root {
        --chat-bg: #ffffff;
        --sidebar-bg: #f7f7f8;
        --input-bar-bg: #ffffff;
        --input-field-bg: #f9fafb;
        --text-primary: #111827;
        --text-secondary: #6b7280;
        --border-color: #e5e7eb;
        --hover-bg: #f3f4f6;
        --active-bg: #e5e7eb;
        --modal-bg: #ffffff;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --ai-bubble-bg: transparent;
        --user-bubble-bg: #3b82f6;
        --button-primary-bg: #3b82f6;
        --button-primary-hover-bg: #2563eb;
        --button-primary-text: #ffffff;
    }
    .dark {
        --chat-bg: #111111;
        --sidebar-bg: #1c1c1c;
        --input-bar-bg: #1c1c1c;
        --input-field-bg: #2d2d2d;
        --text-primary: #f9fafb;
        --text-secondary: #9ca3af;
        --border-color: #374151;
        --hover-bg: #374151;
        --active-bg: #4b5563;
        --modal-bg: #1f2937;
        --shadow-color: rgba(0, 0, 0, 0.4);
        --user-bubble-bg: #2563eb;
        --user-bubble-bg: transparent;
    }
        .model-message .message-bubble {
        box-shadow: none;
    }
    body { background-color: var(--chat-bg); color: var(--text-primary); }
    .scroll-area {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: contain;
    }
    body.modal-open {
        overflow: hidden;
    }
    .scroll-area::-webkit-scrollbar { width: 8px; }
    .scroll-area::-webkit-scrollbar-track { background: transparent; }
    .scroll-area::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
    .scroll-area::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    #notification-container {
        position: fixed;
        top: 1.5rem;
        right: 1.5rem;
        z-index: 100;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    .notification {
        padding: 1rem 1.5rem;
        border-radius: 1rem;
        font-weight: 500;
        animation: fadeInRight 0.3s ease, fadeOutRight 0.3s ease 2.7s forwards;
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(255, 255, 255, 0.2);
        color: var(--text-primary);
    }
    .dark .notification {
        background-color: rgba(20, 20, 20, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    }
    .notification.success { color: #22c55e; }
    .notification.error { color: #ef4444; }
    .notification.warning { color: #f97316; }
    .message-item { animation: slideInUp 0.4s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeInRight { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }
    @keyframes fadeOutRight { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(100%); } }
    @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInChar {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.fade-in-char {
    display: inline-block; /* 讓 transform 生效 */
    animation: fadeInChar 0.25s ease-out forwards;
}

/* ✨ 新增：打字機游標效果 (可選) */
.typing-cursor::after {
    content: '▋';
    display: inline-block;
    animation: blink 0.7s infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}
    .loading-dots { display: flex; align-items: center; justify-content: center; height: 1.25rem; }
    .loading-dots span { display: inline-block; width: 8px; height: 8px; margin: 0 2px; background-color: var(--text-secondary); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    .loading-dots span:nth-child(3) { animation-delay: 0s; }
    @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    .prose code:not(pre *) { background-color: var(--hover-bg); padding: 0.2em 0.4em; margin: 0; font-size: 85%; border-radius: 6px; color: var(--text-primary); border: 1px solid var(--border-color); }
    .prose pre {
    background-color: #111827;
    color: #f3f4f6;
    padding: 1em;
    border-radius: 0.5em;
    overflow-x: auto;
    white-space: pre-wrap; /* ---> 新增：允許程式碼在保留格式的情況下自動換行 <--- */
    word-break: break-all;  /* ---> 新增：強制過長的單詞(如URL)也能被斷開 <--- */
}
    .prose pre code { background-color: transparent; padding: 0; color: inherit; border: none; }
    .prose h1, .prose h2, .prose h3 { margin-top: 1.5em; margin-bottom: 0.5em; font-weight: bold; }
    .prose h1 { font-size: 1.875rem; }
    .prose h2 { font-size: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.3em; }
    .prose h3 { font-size: 1.25rem; }
    .prose p { margin-bottom: 1em; }
    .prose table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1em;
  max-width: 100%;
  word-break: break-all;
  table-layout: fixed;
}
    .prose table th, .prose table td { border: 1px solid var(--border-color); padding: 0.75rem; text-align: left; }
    .prose table thead { background-color: var(--hover-bg); }
    .prose table tr:nth-child(even) { background-color: var(--hover-bg); }
    .prose ul, .prose ol { margin-bottom: 1em; padding-left: 1.5em; }
    .prose ul li, .prose ol li { margin-bottom: 0.5em; }
    .folder-summary {
        cursor: pointer;
    }
    .color-swatch, .icon-option { transition: transform 0.2s; border: 2px solid transparent; }
    .color-swatch:hover, .icon-option:hover { transform: scale(1.1); }
    .color-swatch.selected { border-color: #3b82f6; }
    .icon-option.selected { background-color: var(--active-bg); border-color: #3b82f6; }
    #sidebar.open {
        transform: translateX(0);
    }
    @media (min-width: 1024px) {
    /* --- 新增開始 --- */

    /* 1. 讓 #app-container 準備好接收 sidebar-open 這個 class */
    #app-container > .relative.flex {
        transition: padding-left 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    }

    /* 2. 電腦版的側邊欄基礎樣式：不再是 fixed 定位 */
    #sidebar {
        position: static; /* 改為靜態定位，讓它回到正常的文檔流中 */
        transform: translateX(0) !important; /* 移除 transform 效果 */
        transition: margin-left 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); /* 動畫效果改為控制 margin-left */
        margin-left: -288px; /* 預設將自己藏到左邊 (288px 是 w-72 的寬度) */
    }

    /* 3. 當側邊欄展開時的樣式 */
    #app-container.sidebar-open #sidebar {
        margin-left: 0; /* 展開時，margin-left 歸零，回到正常位置 */
    }
    
    /* 4. 當側邊欄展開時，推擠主聊天室 */
    #app-container.sidebar-open main {
        /* 這一步不是必要的，但可以增加穩定性 */
        /* 如果未來主聊天室有 margin-left, 這裡會確保它被正確推擠 */
    }

    /* 5. 在電腦版上，永遠隱藏黑色遮罩 */
    #sidebar-overlay {
        display: none !important;
    }

    /* --- 新增結束 --- */
}
    .theme-button-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
        padding: 0.25rem;
        background-color: var(--sidebar-bg);
        border-radius: 0.5rem;
    }
    .theme-btn {
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        text-align: center;
        transition: background-color 0.2s;
    }
.btn-primary {
    background: var(--button-primary-bg-override, linear-gradient(to bottom,
        color-mix(in srgb, var(--button-primary-bg) 95%, white) 0%,
        color-mix(in srgb, var(--button-primary-bg) 90%, black) 100%
    ));
    color: var(--button-primary-text);
    border: 1px solid color-mix(in srgb, var(--button-primary-bg) 50%, black);
    border-bottom-color: color-mix(in srgb, var(--button-primary-bg) 40%, black);
    box-shadow:
        inset 0 1px 1px rgba(255, 255, 255, 0.45),
        0 4px 8px rgba(0, 0, 0, 0.2);
    text-shadow: 0 -1px 1px rgba(0, 0, 0, 0.2);
    position: relative;
    transition: all 0.15s ease-out;
}
.btn-primary::before {
    content: '';
    position: absolute;
    top: 1px;
    left: 2px;
    right: 2px;
    height: 50%;
    background: linear-gradient(to bottom,
        rgba(255, 255, 255, 0.5),
        rgba(255, 255, 255, 0)
    );
    border-radius: inherit;
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
}
.btn-primary:hover:not(:disabled) {
    filter: brightness(1.05);
    transform: translateY(-2px);
    box-shadow:
        inset 0 1px 1px rgba(255, 255, 255, 0.5),
        0 6px 12px rgba(0, 0, 0, 0.25);
}
.btn-primary:active:not(:disabled) {
    transform: translateY(1px);
    filter: brightness(0.9);
    box-shadow:
        inset 0 2px 4px rgba(0, 0, 0, 0.3);
    transition-duration: 0.05s;
}
    .theme-btn.active {
        background: var(--button-primary-bg);
        color: var(--button-primary-text);
    }
    .follow-up-prompt-btn {
    background-color: var(--hover-bg);
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    cursor: pointer;
    white-space: normal;
    overflow: hidden;
    text-overflow: unset;
    max-width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    word-break: break-word;
    opacity: 0;
    transform: translateY(10px);
    animation: subtleFadeInUp 0.4s ease-out forwards;
    animation-delay: var(--animation-delay, 0s);
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
    #follow-up-prompts-list {
  max-height: 200px;
  overflow-y: auto;
  transition: max-height 0.3s ease-out, margin-top 0.3s ease-out;
}
#follow-up-prompts-list:not(.collapsed) {
    margin-top: 0.5rem;
}
#follow-up-prompts-list.collapsed {
    max-height: 0;
    margin-top: 0;
    margin-bottom: 0;
    overflow: hidden;
}
    .follow-up-prompt-btn:hover {
        background-color: var(--active-bg);
        color: var(--text-primary);
    }
    .toggle-checkbox:checked {
        right: 0;
        border-color: #3b82f6;
    }
    .toggle-checkbox:checked + .toggle-label {
        background-color: #3b82f6;
    }
    .toggle-checkbox:focus + .toggle-label {
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
    }
    .toggle-checkbox:checked + .toggle-label:before {
        transform: translateX(1.5rem);
    }
    .toggle-label {
         transition: background-color 0.2s ease-in-out;
    }
    .toggle-label:before {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: calc(1.5rem - 4px);
        height: calc(1.5rem - 4px);
        border-radius: 9999px;
        background-color: #fff;
        transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .model-description {
        font-size: 0.75rem;
        color: var(--text-secondary);
        line-height: 1.2;
        margin-top: 0.25rem;
    }
    .model-option-btn-container {
        display: block;
        width: 100%;
        text-align: left;
        padding: 0.75rem 1rem;
        cursor: pointer;
    }
    .model-option-btn-container:hover {
        background-color: var(--hover-bg);
    }
    #model-options-popover {
        max-height: calc(100vh - 150px);
    }
    .message-bubble {
  position: relative;
  background-color: transparent;
  z-index: 0;
  max-width: 100vw;
  overflow-x: auto;
}
    .message-bubble::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        border-radius: 0.5rem;
        z-index: -1;
    }
    .model-message .message-bubble::before {
        background-color: var(--ai-bubble-bg);
    }
    .user-message .message-content {
        white-space: pre-line;
    }
    .user-message .message-bubble::before {
        background-color: var(--user-bubble-bg);
    }
    .file-preview-item {
         animation: subtleScaleIn 0.3s ease-out forwards;
    }
    .color-dropdown-container {
        position: relative;
    }
    .color-dropdown-btn {
        width: 100%;
        padding: 0.5rem 1rem;
        background-color: var(--input-field-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.375rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
    }
    .color-preview {
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 0.25rem;
        border: 1px solid var(--border-color);
    }
    .color-dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        max-height: 200px;
        overflow-y: auto;
        background-color: var(--modal-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.375rem;
        z-index: 10;
        display: none;
        opacity: 0;
        transform: translateY(-10px);
        transition: opacity 0.2s ease, transform 0.2s ease;
    }
    .color-dropdown-menu.show {
        display: block;
        opacity: 1;
        transform: translateY(0);
    }
    .color-option {
        padding: 0.5rem 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
    }
    .color-option:hover {
        background-color: var(--hover-bg);
    }
    .settings-nav-item {
        cursor: pointer;
    }
    .settings-nav-item:hover {
        background-color: var(--hover-bg);
    }
    .settings-nav-item.active {
        background-color: var(--active-bg);
        font-weight: bold;
    }
    .voice-input-btn {
        flex-shrink: 0;
        height: 2.5rem;
        width: 2.5rem;
        border-radius: 9999px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
    }
    .voice-input-btn:hover {
        background-color: var(--hover-bg);
    }
    .voice-input-btn.active {
        color: #ef4444;
        background-color: var(--hover-bg);
    }
    .pinned-icon {
        color: #fbbf24;
    }
    #wallpaper-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-size: cover;
    background-position: center;
    z-index: -1;
    display: none;
    transition: opacity 0.3s ease-in-out;
    pointer-events: none;
    -webkit-touch-callout: none;
    user-select: none;
    }
    body.custom-wallpaper-active #add-file-btn {
    color: var(--text-primary) !important;
}
    body.custom-wallpaper-active #history-sidebar h3 {
    color: #111827 !important; 
}
body.custom-wallpaper-active .voice-input-btn {
    color: var(--text-primary) !important;
}
body.custom-wallpaper-active .voice-input-btn.active {
    color: #ef4444 !important; 
}
    body.custom-wallpaper-active #wallpaper-container {
        display: block;
    }
    body.custom-wallpaper-active {
        background-color: transparent !important;
    }
    body.custom-wallpaper-active #app-container > .bg-\[var\(--chat-bg\)\] {
        background-color: transparent !important;
    }
    body.custom-wallpaper-active .bg-\[var\(--input-bar-bg\)\] {
        background-color: transparent !important;
        border-color: transparent !important;
    }
    body.custom-wallpaper-active #settings-modal .bg-\[var\(--sidebar-bg\)\] {
        background-color: transparent !important;
        border-color: transparent !important;
    }
    body.custom-wallpaper-active #settings-modal .border-t {
        border-color: transparent !important;
    }
    body.custom-wallpaper-active #search-modal > div,
    body.custom-wallpaper-active #astras-create-modal > div,
    body.custom-wallpaper-active #data-dashboard-modal > div,
    body.custom-wallpaper-active #settings-modal > div,
    body.custom-wallpaper-active #custom-dialog-modal > div {
        background-color: var(--modal-bg) !important;
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        border-color: var(--border-color) !important;
    }
    body.custom-wallpaper-active #update-info-modal > div,
    body.custom-wallpaper-active #latest-update-modal > div {
        background-color: rgba(255, 255, 255, 0.65) !important;
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border-color: rgba(200, 200, 200, 0.5) !important;
    }
    body.custom-wallpaper-active #model-options-popover {
        background-color: rgba(255, 255, 255, 0.35) !important;
        backdrop-filter: blur(16px) !important;
        -webkit-backdrop-filter: blur(16px) !important;
        border: 1px solid rgba(200, 200, 200, 0.5) !important;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
    body.custom-wallpaper-active main > header {
        background-color: rgba(255, 255, 255, 0.25) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        border-color: rgba(255, 255, 255, 0.2) !important;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
    body.custom-wallpaper-active #history-sidebar {
    backdrop-filter: blur(20px); /* 套用背景模糊濾鏡 */
    -webkit-backdrop-filter: blur(20px); /* 針對 Safari 等 Webkit 瀏覽器的兼容寫法 */
    background-color: rgba(255, 255, 255, 0.55); /* 設定半透明的白色背景 */
    border-left: 1px solid rgba(255, 255, 255, 0.6) !important; /* 設定更亮的半透明左邊框，!important 用於覆蓋原有樣式 */
    box-shadow: -4px 0px 15px rgba(0, 0, 0, 0.05); /* 加上陰影以突顯層次感，X軸設為負值讓陰影在左側 */
}

/* 針對自訂桌布模式下的右側側邊欄 (深色桌布) */
body.custom-wallpaper-active.wallpaper-is-dark #history-sidebar {
    background-color: rgba(30, 30, 30, 0.5); /* 設定半透明的深色背景 */
    border-left: 1px solid rgba(255, 255, 255, 0.1) !important; /* 設定半透明的亮色左邊框 */
    box-shadow: -4px 0px 20px rgba(0, 0, 0, 0.2); /* 加上更深的陰影 */
}

    body.custom-wallpaper-active.wallpaper-is-dark main > header {
        background-color: rgba(30, 30, 30, 0.25) !important;
        border-color: rgba(255, 255, 255, 0.15) !important;
    }
    body.custom-wallpaper-active .input-wrapper {
        background-color: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
    body.custom-wallpaper-active #message-input {
        background-color: transparent !important;
    }
    body.custom-wallpaper-active .message-bubble {
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    body.custom-wallpaper-active .message-bubble::before {
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
    }
    body.custom-wallpaper-active .model-message .message-bubble::before {
        background-color: var(--ai-bubble-bg);
    }
    body.custom-wallpaper-active .model-message .message-bubble {
        color: #111827 !important;
    }
    body.custom-wallpaper-active .model-message .message-bubble .prose {
        color: #111827 !important;
    }
    body.custom-wallpaper-active .user-message .message-bubble::before {
        background-color: var(--user-bubble-bg);
    }
    body.custom-wallpaper-active .user-message .message-bubble {
        color: #111827 !important;
    }
    body.custom-wallpaper-active .user-message .message-bubble .prose {
        color: #111827 !important;
    }
    body.custom-wallpaper-active .model-message .message-bubble .prose pre {
        background-color: rgba(0, 0, 0, 0.05);
    }
    body.custom-wallpaper-active .model-message .message-bubble .prose code,
    body.custom-wallpaper-active .model-message .message-bubble .prose pre code {
         color: #111827 !important;
    }
    body.custom-wallpaper-active {
        --text-primary: #111827;
        --text-secondary: #6b7280;
    }
    body.custom-wallpaper-active #message-input::placeholder {
    color: var(--text-primary) !important;
}
    body.custom-wallpaper-active .theme-button-group {
        opacity: 0.5;
        pointer-events: none;
    }
    body.custom-wallpaper-active #message-list > div.text-center {
        background-color: rgba(255, 255, 255, 0.35);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        max-width: max-content;
        margin: 4rem auto 0;
    }
    body.custom-wallpaper-active.wallpaper-is-dark {
        --text-primary: #f9fafb;
        --text-secondary: #9ca3af;
    }
    body.custom-wallpaper-active #update-info-modal .p-4.bg-\[var\(--sidebar-bg\)\],
    body.custom-wallpaper-active #latest-update-modal .p-4.bg-\[var\(--sidebar-bg\)\] {
        background-color: transparent !important;
        border-top-color: rgba(200, 200, 200, 0.5) !important;
    }
    .sidebar, .sidebar button, .sidebar input, .sidebar h2, .sidebar span {
        color: #111827;
    }
    .sidebar .text-\[var\(--text-secondary\)\] {
        color: #6b7280 !important;
    }
    .dark .sidebar .sidebar-item.active, .sidebar .sidebar-item.active {
        color: #111827;
    }
    .dark .sidebar-item:hover, .sidebar-item:hover {
        color: #111827;
    }
    #logout-btn, .folder-options-btn, .chat-options-btn, .astras-options-btn, #new-folder-btn, #new-astras-btn {
        color: #6b7280;
    }
    #logout-btn:hover, .folder-options-btn:hover, .chat-options-btn:hover, .astras-options-btn:hover, #new-folder-btn:hover, #new-astras-btn:hover {
        color: #111827;
    }
    .pinned-icon {
        color: #fbbf24;
    }
    #settings-modal .settings-section {
        color: #111827;
    }
    #settings-modal .settings-section h3,
    #settings-modal .settings-section label,
    #settings-modal .settings-section p,
    #settings-modal .settings-section button,
    #settings-modal .settings-section input,
    #settings-modal .settings-section select,
    #settings-modal .settings-section textarea,
    #settings-modal .settings-section span {
        color: #111827;
    }
    #settings-modal .settings-section .text-\[var\(--text-secondary\)\] {
        color: #6b7280 !important;
    }
    .dark #settings-modal .settings-section input,
    .dark #settings-modal .settings-section select,
    .dark #settings-modal .settings-section textarea {
        background-color: #f0f0f0;
        border-color: #d1d5db;
    }
    #model-options-popover .model-option-btn-container h4,
    #model-options-popover .model-option-btn-container .model-description {
        color: #111827 !important;
    }
    #settings-modal .p-6.border-b h2 {
        color: #111827;
    }
    #settings-modal .settings-nav-item {
        color: #111827;
    }
    #close-settings-btn {
        color: #111827;
    }
    #close-astras-btn {
        color: #111827;
    }
    #upload-wallpaper-btn {
        background-color: #3b82f6;
        color: #ffffff !important;
    }
    #upload-wallpaper-btn:hover {
        background-color: #2563eb;
    }
    #restore-wallpaper-btn {
        background-color: #6b7280;
        color: #ffffff !important;
    }
    #restore-wallpaper-btn:hover {
        background-color: #4b5563;
    }
    #export-data-btn {
        background-color: #3b82f6;
        color: #ffffff !important;
    }
    #export-data-btn:hover {
        background-color: #2563eb;
    }
    #import-data-btn {
        background-color: #16a34a;
        color: #ffffff !important;
    }
    #import-data-btn:hover {
        background-color: #15803d;
    }
    .modal > div, .popover {
        color: #111827;
    }
    .modal { pointer-events: none; }
.modal.visible { pointer-events: auto; }

/* 只要不是 .visible，就強制讓內容不可見且不可點（防手機版覆寫） */
.modal:not(.visible) .settings-section,
.modal.hidden .settings-section {
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* 萬一還有其他子孫元素在搗亂，順手保險一下： */
.modal:not(.visible) * { pointer-events: none !important; }
    .modal h2, .modal h3, .modal p, .modal label, .modal span,
    .modal input, .modal select, .modal textarea {
        color: #111827;
    }
    .modal button, .popover button {
        color: #111827;
    }
    .modal .text-\[var\(--text-secondary\)\] {
        color: #6b7280 !important;
    }
    .modal .btn-primary, .modal #confirm-import-btn {
        color: #ffffff !important;
    }
    .modal .text-red-500, .modal .text-red-600, .popover .text-red-600 {
        color: #ef4444 !important;
    }
    .dark .modal input, .dark .modal select, .dark .modal textarea {
        background-color: #f0f0f0;
        border-color: #d1d5db;
    }
    .model-suffix {
        display: inline-block;
        padding: 2px 8px;
        font-size: 0.6rem;
        font-weight: 600;
        line-height: 1.2;
        border-radius: 9999px;
        flex-shrink: 0;
        margin-left: 4px;
        background-color: rgba(0, 0, 0, 0.05);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        color: var(--text-secondary);
    }
    .dark .model-suffix {
        background-color: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.15);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    }
    .sidebar-item:hover .model-suffix {
        display: none;
    }
    @keyframes pulse-red-border {
        0%, 100% {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.4);
        }
        50% {
            border-color: #f87171;
            box-shadow: 0 0 0 0px rgba(239, 68, 68, 0);
        }
    }
    .dialog-warning-border {
        animation: pulse-red-border 1.5s infinite;
    }
    #wallpaper-crop-container {
        width: 100%;
        max-height: 60vh;
        margin-bottom: 1rem;
    }
    #wallpaper-crop-container img {
        max-width: 100%;
    }
    .dark body,
    .dark .sidebar *,
    .dark #settings-modal *,
    .dark .modal > div *,
    .dark .popover *,
    .dark #model-options-popover .model-option-btn-container h4,
    .dark #model-options-popover .model-option-btn-container .model-description,
    .dark #header-title,
    .dark #current-astras-name,
    .dark .model-message .message-bubble,
    .dark .model-message .message-bubble .prose,
    .dark .model-message .message-bubble .prose *,
    .dark .follow-up-prompt-btn,
    .dark .color-dropdown-btn span,
    .dark #message-input::placeholder {
        color: #ffffff !important;
    }
    .dark #settings-modal .settings-section input,
    .dark #settings-modal .settings-section select,
    .dark #settings-modal .settings-section textarea,
    .dark .modal input,
    .dark .modal select,
    .dark .modal textarea {
        color: #111827 !important;
    }
    .dark .btn-primary, .dark .modal .btn-primary, .dark #confirm-import-btn {
        color: var(--button-primary-text, #ffffff) !important;
    }
    .dark .text-red-500, .dark .text-red-600, .dark .popover .text-red-600,
    .dark .notification.error {
        color: #ef4444 !important;
    }
    .dark .notification.success {
        color: #22c55e !important;
    }
    .dark .notification.warning {
        color: #f97316 !important;
    }
    .dark .pinned-icon {
        color: #fbbf24 !important;
    }
    .dark .model-suffix {
        color: #ffffff !important;
        background-color: rgba(255, 255, 255, 0.15) !important;
        border-color: rgba(255, 255, 255, 0.25) !important;
    }
    .demo-model-selector .selector-btn {
        transition: all 0.3s ease;
    }
    .demo-model-selector .selector-btn.active {
        color: #2563eb;
        background-color: #eff6ff;
        border-color: #2563eb;
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .demo-chat-content {
        display: none;
        animation: fadeIn 0.5s ease-in-out;
    }
    .demo-chat-content.active {
        display: block;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    .message-content {
    transition: opacity 0.2s ease-in-out;
}
    .astras-store-card {
        background-color: var(--sidebar-bg);
        border: 1px solid var(--border-color);
        border-radius: 1rem;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        animation: subtleFadeInUp 0.5s ease-out forwards;
    }
    .astras-store-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px var(--shadow-color), 0 4px 6px -2px var(--shadow-color);
    }
    .astras-card-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 1rem;
        background-color: var(--hover-bg);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: bold;
        color: var(--text-secondary);
        border: 2px solid var(--border-color);
        flex-shrink: 0;
    }
    .astras-card-avatar img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
    }
    .astras-card-name {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
        color: var(--text-primary);
    }
    .astras-card-desc {
        font-size: 0.875rem;
        color: var(--text-secondary);
        flex-grow: 1;
        margin-bottom: 1.5rem;
    }
    .subscribe-btn {
        width: 100%;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
    }
    .subscribe-btn.subscribed {
        background-color: #10b981;
        color: white;
    }
    .subscribe-btn.subscribed:hover {
        background-color: #059669;
    }
    .astras-sidebar-avatar {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 0.75rem;
        background-color: var(--hover-bg);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: bold;
        color: var(--text-secondary);
        flex-shrink: 0;
    }
    #avatar-crop-container .cropper-view-box,
    #avatar-crop-container .cropper-face {
        border-radius: 50%;
    }
    body.custom-wallpaper-active .astras-store-card {
    background-color: rgba(255, 255, 255, 0.65) !important;
    backdrop-filter: blur(16px) !important;
    -webkit-backdrop-filter: blur(16px) !important;
    border: 1px solid rgba(255, 255, 255, 0.4) !important;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1) !important;
}
    body.custom-wallpaper-active #store-container {
    background-color: transparent !important;
}
    body.custom-wallpaper-active #store-container header h1,
body.custom-wallpaper-active #store-container header #back-to-chat-btn,
body.custom-wallpaper-active .astras-card-name,
body.custom-wallpaper-active .astras-card-desc,
body.custom-wallpaper-active .astras-card-avatar {
    color: #000000 !important;
}
body.custom-wallpaper-active #store-container .border-b {
    border-color: rgba(255, 255, 255, 0.2) !important;
}
body.custom-wallpaper-active .store-category-btn {
    background-color: rgba(255, 255, 255, 0.3);
    border-color: rgba(255, 255, 255, 0.4);
    color: #111827;
}
body.custom-wallpaper-active .store-category-btn:hover {
    background-color: rgba(255, 255, 255, 0.5);
    border-color: rgba(255, 255, 255, 0.8);
}
body.custom-wallpaper-active .store-category-btn.active {
    border-color: transparent !important;
    color: var(--button-primary-text) !important;
    background: var(--button-primary-bg) !important;
}
    #mobile-context-menu-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0,0,0,0.5);
        z-index: 99;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    #mobile-context-menu {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: var(--modal-bg);
        border-top-left-radius: 1.5rem;
        border-top-right-radius: 1.5rem;
        z-index: 100;
        padding: 1rem;
        transform: translateY(100%);
        transition: transform 0.3s ease-out;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
        touch-action: none;
    }
    #mobile-context-menu.visible {
        transform: translateY(0);
    }
    #mobile-context-menu-overlay.visible {
        opacity: 1;
    }
    #mobile-context-menu .menu-header {
        padding: 0.5rem 1rem;
        text-align: center;
        font-weight: 600;
        color: var(--text-primary);
        background-color: var(--sidebar-bg);
        border-radius: 0.75rem;
        margin-bottom: 1rem;
    }
    #mobile-context-menu .menu-options {
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    #mobile-context-menu .menu-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        gap: 1rem;
        border-bottom: 1px solid var(--border-color);
        cursor: pointer;
        font-size: 1rem;
        color: var(--text-primary);
    }
    #mobile-context-menu .menu-item:last-child {
        border-bottom: none;
    }
    #mobile-context-menu .menu-item:hover {
        background-color: var(--hover-bg);
    }
    #mobile-context-menu .menu-item.delete {
        color: #ef4444;
    }
    #mobile-context-menu .menu-item svg {
        width: 24px;
        height: 24px;
        color: var(--text-secondary);
    }
     #mobile-context-menu .menu-item.delete svg {
        color: #ef4444;
    }
    .dark #mobile-context-menu .menu-header,
    .dark #mobile-context-menu .menu-item {
        color: var(--text-primary);
    }
    .dark #mobile-context-menu .menu-item svg {
        color: var(--text-secondary);
    }
    .dark #mobile-context-menu .menu-item.delete {
        color: #ef4444 !important;
    }
    .dark #mobile-context-menu .menu-item.delete svg {
        color: #ef4444 !important;
    }
    body.custom-wallpaper-active #mobile-context-menu {
        color: #111827 !important;
        background-color: rgba(255, 255, 255, 0.85) !important;
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border-color: rgba(200, 200, 200, 0.5) !important;
    }
    body.custom-wallpaper-active #mobile-context-menu .menu-header,
    body.custom-wallpaper-active #mobile-context-menu .menu-item {
         color: #111827 !important;
    }
    body.custom-wallpaper-active #mobile-context-menu .menu-item svg {
        color: #6b7280 !important;
    }
    body.custom-wallpaper-active #mobile-context-menu .menu-item.delete,
    body.custom-wallpaper-active #mobile-context-menu .menu-item.delete svg {
        color: #ef4444 !important;
    }
    @media (max-width: 768px) {
      input[type="text"],
      input[type="search"],
      input[type="password"],
      textarea,
      select {
        font-size: 16px !important;
      }
      .sidebar-item .chat-options-btn,
      .sidebar-item .astras-options-btn,
      .folder-summary .folder-options-btn {
          display: none;
      }
    }
    @media (max-width: 768px) {
      #settings-modal .flex.flex-1.overflow-hidden {
        flex-direction: column;
      }
      #settings-modal nav.w-1\/4 {
        display: none;
      }
      #settings-modal .flex-1.p-6.overflow-y-auto {
        width: 100%;
        border-right: none;
      }
      #settings-modal .settings-section {
        display: block !important;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 1.5rem;
        margin-bottom: 1.5rem;
      }
      #settings-modal .settings-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }
    }
    @media (max-width: 640px) {
        #search-modal .p-4.flex.items-center {
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        #modal-search-input {
            flex-basis: 100%;
            order: 1;
        }
        #modal-search-scope-select {
            flex-grow: 1;
            order: 2;
        }
        #perform-search-btn {
            order: 3;
        }
        #voice-input-btn-search {
            order: 4;
        }
    }
    .sidebar-item, .folder-summary {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    .model-message .prose {
        overflow-x: auto;
        -ms-overflow-style: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--border-color) transparent;
    }
    .model-message .prose::-webkit-scrollbar {
        height: 8px;
    }
    .model-message .prose::-webkit-scrollbar-track {
        background: transparent;
    }
    .model-message .prose::-webkit-scrollbar-thumb {
        background-color: var(--border-color);
        border-radius: 10px;
        border: 2px solid transparent;
        background-clip: content-box;
    }
    .model-message .prose::-webkit-scrollbar-thumb:hover {
        background-color: var(--text-secondary);
    }
    @keyframes jelly-bounce {
        0%, 100% { transform: scale(1) translateX(-50%); }
        25% { transform: scale(0.9, 1.1) translateX(-50%); }
        50% { transform: scale(1.1, 0.9) translateX(-50%); }
        75% { transform: scale(0.95, 1.05) translateX(-50%); }
    }
    #scroll-to-bottom-btn {
        position: absolute;
        left: 50%;
        z-index: 20;
        width: 40px;
        height: 40px;
        border-radius: 9999px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        opacity: 0;
        transform: translateX(-50%) scale(0.8);
        pointer-events: none;
        transition: opacity 0.3s ease, transform 0.3s ease, bottom 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
    }
    #scroll-to-bottom-btn.visible {
        opacity: 1;
        transform: translateX(-50%) scale(1);
        pointer-events: auto;
    }
    #scroll-to-bottom-btn.jelly-animate {
        animation: jelly-bounce 0.5s ease-out;
    }
    #scroll-to-bottom-btn {
        background-color: rgba(255, 255, 255, 0.9);
        color: #111827;
        box-shadow: 0 4px 8px var(--shadow-color);
        border: 1px solid var(--border-color);
    }
    .dark #scroll-to-bottom-btn {
        background-color: rgba(30, 30, 30, 0.9);
        color: #f9fafb;
        border: 1px solid var(--border-color);
    }
    body.custom-wallpaper-active #scroll-to-bottom-btn {
        background-color: var(--button-primary-bg);
        color: #ffffff;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow:
            0 4px 12px rgba(0, 0, 0, 0.2),
            inset 0 1px 2px rgba(255, 255, 255, 0.4);
        background-image: radial-gradient(circle at 50% 0%, rgba(255, 255, 255, 0.35) 0%, rgba(255, 255, 255, 0) 60%);
        transition: opacity 0.3s ease, transform 0.3s ease, bottom 0.3s ease, background-position 0.4s ease;
        background-size: 200% 200%;
        background-position: 50% 100%;
    }
    body.custom-wallpaper-active #scroll-to-bottom-btn:hover {
        background-position: 50% 50%;
        transform: translateX(-50%) scale(1.05);
    }
    .search-view-btn {
        display: inline-flex;
    }
    @media (max-width: 768px) {
        .search-view-btn {
            display: none;
        }
    }
    #sidebar,
    #header-title,
    #search-view-modal h2,
    #search-view-modal button,
    #mobile-context-menu,
    #history-popover,
    #message-list .text-center,
    #message-input,
    #model-switcher-container,
    #search-view-content,
    #store-container,
    #search-modal,
    #settings-modal,
    #trash-section,
    #trash-view-modal
    {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    @media (max-width: 768px) {
        .trash-item-view-btn {
            display: none;
        }
    }
    body.custom-wallpaper-active #follow-up-container {
        background-color: transparent !important;
        border-color: transparent !important;
        padding-top: 0 !important;
        padding-bottom: 0.5rem !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
    }
    body.custom-wallpaper-active #follow-up-content-wrapper {
        background-color: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        padding: 0.75rem;
        border-radius: 1rem;
    }
    body.custom-wallpaper-active .follow-up-prompt-btn {
        background-color: rgba(255, 255, 255, 0.3) !important;
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        color: var(--text-primary) !important;
        transition: all 0.2s ease-in-out;
    }
    body.custom-wallpaper-active .follow-up-prompt-btn:hover {
        background-color: rgba(255, 255, 255, 0.5) !important;
        transform: translateY(-2px);
        border-color: rgba(255, 255, 255, 0.6);
    }
        body.custom-wallpaper-active #follow-up-container #follow-up-header h4 {
    color: #111827 !important;
}

/* 2. 在深色模式下，強制標題為白色 (主要文字顏色) */
.dark #follow-up-header h4 {
    color: var(--text-primary) !important;
}
/* --- 新增結束 --- */

.spotlight-effect {
    position: relative;
}
.spotlight-effect::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    border-radius: 1rem;
    background-image: radial-gradient(
        circle 150px at var(--spotlight-x) var(--spotlight-y),
        rgba(255, 255, 255, 0.15) 0%,
        rgba(255, 255, 255, 0) 100%
    );
    opacity: 0;
    transition: opacity 0.3s ease-out;
    pointer-events: none;
}
.spotlight-effect:hover::before {
    opacity: 1;
}
.dark .spotlight-effect::before {
    background-image: radial-gradient(
        circle 150px at var(--spotlight-x) var(--spotlight-y),
        rgba(255, 255, 255, 0.2) 0%,
        rgba(255, 255, 255, 0) 100%
    );
}
    opacity: 0;
    transition: opacity 0.3s ease-out;
    pointer-events: none;
}
.spotlight-effect:hover::before {
    opacity: 1;
}
.dark .spotlight-effect::before {
    background-image: radial-gradient(
        circle 200px at var(--spotlight-x) var(--spotlight-y),
        rgba(255, 255, 255, 0.12) 0%,
        rgba(255, 255, 255, 0) 100%
    );
}
.input-wrapper {
    flex-direction: column;
    gap: 0.25rem;
}
.input-indicator-item {
    color: var(--button-primary-bg);
    background-color: var(--hover-bg);
    border: 1px solid var(--border-color);
    align-self: flex-start;
    -webkit-user-select: none; /* 適用於 Chrome, Safari, Opera */
    -moz-user-select: none;    /* 適用於 Firefox */
    -ms-user-select: none;     /* 適用於 Internet Explorer/Edge */
    user-select: none;         /* 標準語法 */
}
.dark .input-indicator-item {
    background-color: var(--hover-bg);
    border: 1px solid var(--border-color);
}
body.custom-wallpaper-active .input-indicator-item {
    background-color: rgba(255, 255, 255, 0.2) !important;
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    color: var(--button-primary-bg) !important;
}
#input-bar-container .input-wrapper > .flex.items-end {
    width: 100%;
}
/* ✨ 新增：互動式計畫編輯器樣式 */
.plan-editor-step {
    background-color: var(--input-field-bg);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}
.plan-editor-step .step-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.plan-editor-step .step-header label {
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--text-secondary);
}
.plan-editor-step .remove-step-btn {
    color: var(--text-secondary);
    padding: 0.25rem;
    border-radius: 9999px;
}
.plan-editor-step .remove-step-btn:hover {
    background-color: var(--hover-bg);
    color: #ef4444; /* red-500 */
}
.plan-editor-step .remove-step-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.plan-editor-step input[type="text"],
.plan-editor-step textarea {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    background-color: var(--modal-bg);
    color: var(--text-primary);
    font-size: 1rem;
}
.dark .plan-editor-step input[type="text"],
.dark .plan-editor-step textarea {
    background-color: var(--input-field-bg);
}
.plan-editor-step textarea {
    min-height: 80px;
    resize: vertical;
}
    body.custom-wallpaper-active.wallpaper-is-dark #interactive-plan-modal .plan-editor-step label,
body.custom-wallpaper-active.wallpaper-is-dark #interactive-plan-modal .plan-editor-step input,
body.custom-wallpaper-active.wallpaper-is-dark #interactive-plan-modal .plan-editor-step textarea {
    color: #111827 !important; 
}

/* ✨ 新增：深度研究儀表板樣式 */
.research-dashboard {
    background-color: var(--sidebar-bg);
    border: 1px solid var(--border-color);
    padding: 1rem 1.5rem;
    border-radius: 0.75rem;
    max-w-4xl mx-auto;
    animation: subtleFadeInUp 0.4s ease-out;
}
.research-dashboard h4 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-primary);
}
.research-dashboard .main-spinner {
    width: 18px;
    height: 18px;
    border: 2px solid var(--hover-bg);
    border-top-color: var(--button-primary-bg);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
.research-dashboard ul {
    list-style: none;
    padding: 0;
    margin: 0;
    space-y: 0.75rem;
}
.research-step {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
    transition: color 0.3s ease;
}
.research-step .status-icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}
.research-step .status-icon .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid currentColor;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}
.research-step.status-running {
    color: var(--button-primary-bg);
    font-weight: 500;
}
.research-step.status-completed {
    color: #10b981; /* Green-500 */
}
.dark .research-step.status-completed {
    color: #34d399; /* Green-400 */
}
.research-step.status-error {
    color: #ef4444; /* Red-500 */
}
@keyframes spin {
    to { transform: rotate(360deg); }
}

/* --- ✨ 這是切換的關鍵！ END --- */

#auth-container {
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.5s ease-in;
}

#auth-container.visible {
    visibility: visible;
    opacity: 1;
}
#follow-up-container {
    position: fixed; /* 關鍵！讓它固定在螢幕上 */
    top: 3.5rem;       /* <-- 保留這個修改，讓它貼齊頂部 */
    left: 0;
    right: 0;
    z-index: 20;       /* 確保它在最上層 */
    max-width: 48rem;  /* <-- 把這行加回來，限制最大寬度 */
    margin: 0 auto;    /* <-- 把這行加回來，讓它水平置中 */

    /* 動畫效果 */
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    transform: translateY(-20px);
    opacity: 0;
    pointer-events: none; /* 隱藏時不可點擊 */
}
    @media (min-width: 768px) {
    #follow-up-container {
        /* 覆蓋掉 md:p-4 帶來的上下邊距 */
        padding-top: 0;
        padding-bottom: 0;
        /* 移除你不想看到的左右邊距 */
        padding-left: 0;
        padding-right: 0;
    }
}

/* 顯示時的樣式 */
#follow-up-container:not(.hidden) {
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
}

/* 內部容器的毛玻璃效果 */
#follow-up-content-wrapper {
    background-color: rgba(255, 255, 255, 0.65);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 1rem;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
    padding: 0.75rem;
}

.dark #follow-up-content-wrapper {
    background-color: rgba(30, 30, 30, 0.65);
    border: 1px solid rgba(255, 255, 255, 0.15);
}

/* 手機版的滑動樣式 */
@media (max-width: 768px) {
    #follow-up-container {
         top: 3.3rem; /* 手機版頂部距離可以近一點 */
    }
    #follow-up-prompts-list {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        flex-wrap: nowrap; 
        touch-action: pan-x;
        padding: 0;
        margin: 0;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    #follow-up-prompts-list::-webkit-scrollbar {
        display: none;
    }
    .follow-up-prompt-btn {
        flex: 0 0 100%;
        width: 100%;
        scroll-snap-align: start; 
        white-space: normal;
        word-break: break-word;
        text-overflow: unset;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1.5rem 1rem;
        border-radius: 0.5rem;
        min-height: 0;
    }
}
        .input-wrapper.rounded-full {
    border-radius: 50px;
}
.input-wrapper.rounded-full.has-indicators {
    border-radius: 1.5rem; /* 24px */
}
.input-wrapper {
    transition: border-radius 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                padding-top 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
        @media (max-width: 768px) {
  .chat-greeting-message {
    display: none; /* 將它完全隱藏起來，不佔據任何空間 */
  }
}